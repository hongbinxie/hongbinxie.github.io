<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.proxy.ustclug.org/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="产生背景：没有对比就没有伤害，如过去的上传&#x2F;下载&#x2F;延迟速度。 用谷歌来模拟不同网速下的网站加载速率： Network-&gt;右上的下标Add…-&gt;Add custom profile…-&gt;文件名、上传&#x2F;下载&#x2F;延迟速度-&gt;返回点右上下标中的该文件名，可以在该模式测试当前网页加载速度。">
<meta property="og:type" content="article">
<meta property="og:title" content="05-AjAX">
<meta property="og:url" content="http://yoursite.com/2020/03/29/05-AjAX/index.html">
<meta property="og:site_name" content="凝水为城">
<meta property="og:description" content="产生背景：没有对比就没有伤害，如过去的上传&#x2F;下载&#x2F;延迟速度。 用谷歌来模拟不同网速下的网站加载速率： Network-&gt;右上的下标Add…-&gt;Add custom profile…-&gt;文件名、上传&#x2F;下载&#x2F;延迟速度-&gt;返回点右上下标中的该文件名，可以在该模式测试当前网页加载速度。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-03-29T14:42:20.836Z">
<meta property="article:modified_time" content="2020-03-29T16:06:58.786Z">
<meta property="article:author" content="谢红斌">
<meta property="article:tag" content="AJAX">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2020/03/29/05-AjAX/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true
  };
</script>

  <title>05-AjAX | 凝水为城</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>
  
<link rel="alternate" href="/atom.xml" title="凝水为城" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
	
	<a href="https://your-url" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
	
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">凝水为城</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">谢红斌的博客小栈</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="search-pop-overlay">
  <div class="popup search-popup">
      <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

  </div>
</div>

  </div>
</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/29/05-AjAX/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="谢红斌">
      <meta itemprop="description" content="谢红斌个人网站-记录web前端学习的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凝水为城">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          05-AjAX
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-29 22:42:20" itemprop="dateCreated datePublished" datetime="2020-03-29T22:42:20+08:00">2020-03-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-30 00:06:58" itemprop="dateModified" datetime="2020-03-30T00:06:58+08:00">2020-03-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>产生背景：没有对比就没有伤害，如过去的上传/下载/延迟速度。</p>
<p>用谷歌来模拟不同网速下的网站加载速率：</p>
<p>Network-&gt;右上的下标Add…-&gt;Add custom profile…-&gt;文件名、上传/下载/延迟速度-&gt;返回点右上下标中的该文件名，可以在该模式测试当前网页加载速度。</p>
<a id="more"></a>

<h2 id="知识回顾"><a href="#知识回顾" class="headerlink" title="知识回顾"></a>知识回顾</h2><p>之前学到的 让浏览器<strong>发出对服务端的请求</strong>，获得服务端的数据的几种方式：</p>
<ul>
<li>地址栏输入地址，回车，刷新 </li>
<li>特定元素的 href 或 src 属性 </li>
<li>表单提交</li>
</ul>
<p>但都无法通过、很难通过<strong>代码/编程</strong>来进行对服务端发出请求<strong>并且接受服务端返回的响应</strong>。</p>
<p>过<strong>代码/编程</strong>来进行对服务端发出请求并且接受服务端返回的响应这叫网络编程（发送请求、接收响应）。</p>
<p>编程语言能做的事情取决于API（提供某种特定能力的事物，有输入有输出）。</p>
<p>没学ajax之前不能通过js发请求，必须要将页面刷新一下才能做这操作，所以要学Ajax。</p>
<p>通过Network点XHR可以看到AJAX请求。</p>
<p>XML：最早的服务端返回的响应（数据格式）、描述数据的手段。被json取代了，因为历史原因所以ajax有些内容不改。</p>
<p>学习核心：基本使用、使用封装API、跨域</p>
<h2 id="AJAX简介"><a href="#AJAX简介" class="headerlink" title="AJAX简介"></a>AJAX简介</h2><p>全称：Asynchronous JavaScript and XML。</p>
<p>什么是AJAX：浏览器提供的<strong>一套 API</strong></p>
<p>作用：可以通过 JavaScript 直接发送请求接收响应，从而<strong>实现网络编程</strong>（发送请求、接收响应）。</p>
<p>为什么要有AJAX：能让js发送请求，解决不刷新时想拿到数据的问题。因为之前没办法及时拿到服务端的数据（因为要刷新），不想刷新又想在表格中呈现数据——那只能把数据写死在js代码中，还不如直接写死在html中但也不方便。</p>
<p>学习重点：不是在于我要发个请求，而在于要如何通过代码来发请求（网络编程）</p>
<h2 id="AJAX快速上手"><a href="#AJAX快速上手" class="headerlink" title="AJAX快速上手"></a>AJAX快速上手</h2><p><strong>不考虑兼容就4行代码</strong>。不懂就跳过这块代码看下面的发送请求、接收响应。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 创建一个 XMLHttpRequest 类型的对象 —— 相当于打开了一个浏览器 </span></span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest() </span><br><span class="line"><span class="comment">// 2. 打开与一个网址之间的连接 —— 相当于在地址栏输入访问地址 </span></span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'./time.php'</span>) </span><br><span class="line"><span class="comment">// 3. 通过连接发送一次请求 —— 相当于回车或者点击访问发送请求 </span></span><br><span class="line">xhr.send(<span class="literal">null</span>) </span><br><span class="line"><span class="comment">// 4. 指定 xhr 状态变化事件处理函数 —— 相当于处理网页呈现后的操作 </span></span><br><span class="line"><span class="comment">//onload是HTML5中提供的XMLHttpRequest2.0定义的，否则用onreadystatechange</span></span><br><span class="line">xhr.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;   </span><br><span class="line">	<span class="comment">// 通过 xhr 的 readyState 判断此次请求的响应是否接收完成   </span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !== <span class="number">4</span>) <span class="keyword">return</span>;     </span><br><span class="line">	<span class="comment">// 通过 xhr 的 responseText 获取到响应的响应体   </span></span><br><span class="line">    <span class="comment">//到这ajax操作就结束了。到这里，就是放我们之前所熟悉的代码js。进行发送请求动态获取数据呈现到页面上等</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.responseText)  </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="AJAX发送请求"><a href="#AJAX发送请求" class="headerlink" title="AJAX发送请求"></a>AJAX发送请求</h3><p>AJAX提供的核心类型：XMLHttpRequest。作用——模拟平时上网过程：这三行代码就是ajax的核心</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 涉及到 AJAX 操作的页面“不能”使用文件协议访问（文件的方式访问，某些情况可以；可以http方式访问）</span></span><br><span class="line"><span class="comment">// 1. 安装浏览器（用户代理）</span></span><br><span class="line">    <span class="comment">//  xhr js用户代理对象，就类似于浏览器的作用（发送请求接收响应）</span></span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="type">XMLHttpRequest</span>()</span><br><span class="line">    <span class="comment">// 2. 打开浏览器 输入网址</span></span><br><span class="line">    <span class="comment">//参数：请求方式 网址/相对路径/绝对路径(用/或./表示根目录)</span></span><br><span class="line">    xhr.open(<span class="string">'GET'</span>, <span class="string">'http://day-11.io/time.php'</span>)</span><br><span class="line">    <span class="comment">// 3. 敲回车键 开始请求</span></span><br><span class="line">    xhr.send()</span><br><span class="line">    <span class="comment">// 4. 等待响应（较复杂，先不写）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 看结果</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>在js中类型就是构造函数，可以通过new出来。</p>
</blockquote>
<p>通过Network的XHR可以看到ajax请求，发送完了之后重点就是：接收响应——如何把服务端响应给我们的数据显示/打印出来（怎样把它从js里面拿到）。</p>
<h3 id="AJAX接收响应"><a href="#AJAX接收响应" class="headerlink" title="AJAX接收响应"></a>AJAX接收响应</h3><blockquote>
<p>首先注意：不能通过变量去接收xhr.send()，原因：因为响应需要时间，所以无法通过返回值的方式返回响应。</p>
<p>AJAX是通过<strong>onreadystatechange事件</strong>获取响应（再通过xhr.readState获取响应的内容）。在HTML5中可用<strong>onload事件</strong>代替。</p>
<p>不建议用on的方式注册事件，而是用xhr.addEventListener(‘事件名’, function () {…}) 防止事件注册多次，虽然该事件一般只注册一次但仍建议这样。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">//发送响应过程：1.创建浏览器（代理用户）</span></span><br><span class="line">   <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 如果需要补货第一个状态的变化，需要注意代码执行顺序的问题（不要出现来不及的情况）</span></span><br><span class="line">   <span class="comment">// xhr.onreadystatechange = function () &#123;</span></span><br><span class="line">   <span class="comment">//   // 这个事件并不是只在响应时触发，状态改变就触发</span></span><br><span class="line">   <span class="comment">//   // console.log(1)</span></span><br><span class="line">   <span class="comment">//   console.log(this.readyState)</span></span><br><span class="line">   <span class="comment">// &#125;</span></span><br><span class="line">   </span><br><span class="line"><span class="comment">//2.打开一个地址（以get的方式请求一个地址，请求响应可以用到相对/绝对地址，原因：在同一个网站下面）</span></span><br><span class="line">   xhr.open(<span class="string">'GET'</span>, <span class="string">'./time.php'</span>)</span><br><span class="line"><span class="comment">//3.发送请求</span></span><br><span class="line">   xhr.send()</span><br><span class="line"></span><br><span class="line"><span class="comment">//接收响应过程：4.接收响应</span></span><br><span class="line">   <span class="comment">// 因为客户端永远不知道服务端何时才能返回我们需要的响应，所以 AJAX API 采用事件的机制（通知的感觉）。</span></span><br><span class="line">   xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">     <span class="comment">// 这个事件并不是只在响应时触发，而是XHR 状态改变就触发。注册事件时间的早晚决定接收的数据，所以如果需要补货第一个状态的变化，需要注意代码执行顺序的问题（不要出现来不及的情况）。</span></span><br><span class="line">     <span class="comment">// console.log(1)确认事件能否执行</span></span><br><span class="line"><span class="comment">//我们只关心readState=4接收完响应的状态。写出非的形式代码就不会嵌套了</span></span><br><span class="line">     <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !== <span class="number">4</span>) <span class="keyword">return</span></span><br><span class="line">     <span class="comment">// 获取响应的内容responseText（即响应体），获取响应头的情况较少</span></span><br><span class="line">     <span class="built_in">console</span>.log(<span class="keyword">this</span>.responseText)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="readState"><a href="#readState" class="headerlink" title="readState"></a>readState</h4><table>
<thead>
<tr>
<th>readyState</th>
<th>状态描述</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>UNSENT</td>
<td><strong>初始化</strong>：（请求）代理对象</td>
</tr>
<tr>
<td>1</td>
<td>OPENED</td>
<td>open方法已经调用，<strong>建立</strong>一个与服务端特定端口的<strong>连接</strong></td>
</tr>
<tr>
<td>2</td>
<td>HEADERS_RECEIVED</td>
<td>send() 方法已经被调用，且已<strong>接受到</strong>了响应报文的<strong>响应头</strong>，但没拿到响应体（xhr.getAllResponseHeaders(’指定键可省略‘)可拿到，注意是否用到分割）</td>
</tr>
<tr>
<td>3</td>
<td>LOADING</td>
<td><strong>响应体下载中</strong>（在这里处理响应体不可靠）</td>
</tr>
<tr>
<td>4</td>
<td>DONE</td>
<td>响应体<strong>下载完成</strong>，可以直接使用 responseText 。</td>
</tr>
</tbody></table>
<p>出现阶段：0（代码中写new后）、1（写open后、send后）、（2、3、4）（写接收响应时）</p>
<h2 id="如何在ajax设置请求、响应"><a href="#如何在ajax设置请求、响应" class="headerlink" title="如何在ajax设置请求、响应"></a>如何在ajax设置请求、响应</h2><blockquote>
<p>本质上 XMLHttpRequest 就是 JavaScript 在 Web 平台中发送 HTTP 请求的手段，所以我们发送出去的请求仍然是 HTTP 请求，同样符合 HTTP 约定的格式</p>
</blockquote>
<p>请求：仍然是HTTP请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置请求报文的请求行（协议版本是自动设置的）</span></span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'./time.php'</span>) </span><br><span class="line"><span class="comment">// 设置请求头（设置多个请求头：多执行几次即可）</span></span><br><span class="line">xhr.setRequestHeader(<span class="string">'Accept'</span>, <span class="string">'text/plain'</span>) </span><br><span class="line"><span class="comment">// 一旦你的请求体是 urlencoded 格式的内容，一定要设置请求头中 Content-Type 'application/x-www-form-urlencoded'。   json的：'application/json'</span></span><br><span class="line">xhr.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/x-www-form-urlencoded'</span>)</span><br><span class="line"><span class="comment">// 设置请求体，不设置就为null或不写参数 xhr.send('请求体') </span></span><br><span class="line">xhr.send(<span class="string">'key1=value1&amp;key2=value2'</span>) <span class="comment">// 以 urlencoded 格式设置请求体 '&#123;"foo": "123"&#125;'json格式</span></span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;   <span class="keyword">if</span> (<span class="keyword">this</span>.readyState === <span class="number">4</span>) &#123;     </span><br><span class="line">	<span class="comment">// 获取响应状态码     </span></span><br><span class="line">	<span class="built_in">console</span>.log(<span class="keyword">this</span>.status)    </span><br><span class="line">    <span class="comment">// 获取响应状态描述     </span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.statusText)     </span><br><span class="line">    <span class="comment">// 获取响应头信息     </span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.getResponseHeader(<span class="string">'Content‐Type'</span>)) <span class="comment">// 指定响应头     </span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.getAllResponseHeader())<span class="comment">// 全部响应头     </span></span><br><span class="line">    <span class="comment">// 获取响应体     </span></span><br><span class="line">   <span class="built_in">console</span>.log(<span class="keyword">this</span>.responseText) <span class="comment">// 文本形式   </span></span><br><span class="line">   <span class="built_in">console</span>.log(<span class="keyword">this</span>.responseXML) <span class="comment">// XML 形式，了解即可不用了   </span></span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参考链接：<br><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest</a> </p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest</a></p>
<h2 id="具体用法："><a href="#具体用法：" class="headerlink" title="具体用法："></a>具体用法：</h2><h3 id="数据接口的概念"><a href="#数据接口的概念" class="headerlink" title="数据接口的概念"></a>数据接口的概念</h3><blockquote>
<p>接口（API）概念：只要能提供特定能力、有输入有输出都可以叫接口。2种：编程语言的一些函数、web API（<strong>对于返回数据的地址我们称为接口或数据接口</strong>，只不过形式上是Web形式，如api.douban.com/v2/movie/top250,可以给它？后传参数。可以用自己写的，也可以用别人提供的（前提：别人让你用），如github.com/zce/weapp-demo就是用这个豆瓣接口做的app）。</p>
<p>而ajax操作大部分就是以这种接口的地址作为我们需要去请求的（xhr.open的第二个参数），因为一般是拿数据。</p>
</blockquote>
<h3 id="GET请求及实例"><a href="#GET请求及实例" class="headerlink" title="GET请求及实例"></a>GET请求及实例</h3><p>AJAX发送GET请求并传递参数：</p>
<blockquote>
<p>通常在一次 GET 请求过程中，参数传递都是通过 URL 地址中的 ? 参数传递。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest() </span><br><span class="line"><span class="comment">// GET 请求传递参数通常使用的是问号传参 </span></span><br><span class="line"><span class="comment">// 这里可以在请求地址后面加上参数，从而传递数据到服务端 </span></span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'./delete.php?id=1'</span>) </span><br><span class="line"><span class="comment">// 一般在 GET 请求时无需设置响应体，可以传 null 或者干脆不传 </span></span><br><span class="line">xhr.send(<span class="literal">null</span>) xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;   <span class="keyword">if</span> (<span class="keyword">this</span>.readyState === <span class="number">4</span>) &#123;     <span class="built_in">console</span>.log(<span class="keyword">this</span>.responseText)   </span><br><span class="line">	&#125; </span><br><span class="line">&#125;   </span><br><span class="line"><span class="comment">// 一般情况下 URL 传递的都是参数性质的数据，而 POST 一般都是业务数据</span></span><br></pre></td></tr></table></figure>

<p>实例：要求在界面上把所有用户的名字打印到列表中，然后点击用户名可以再发送个请求——alert拿到用户年龄。</p>
<p>步骤：1.拿到所有的数据2.拿到想要的结果</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">//07-ajax-get.html的</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>AJAX发送GET请求并传递参数<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  //3.的</span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"list"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="comment">//3.的</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> listElement = <span class="built_in">document</span>.getElementById(<span class="string">'list'</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 发送请求获取列表数据呈现在页面</span></span></span><br><span class="line"><span class="actionscript">    <span class="comment">// =======================================</span></span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span></span><br><span class="line">	1.拿到所有的数据</span><br><span class="line"><span class="actionscript">    xhr.open(<span class="string">'GET'</span>, <span class="string">'users.php'</span>)</span></span><br><span class="line"></span><br><span class="line">    xhr.send()</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !== <span class="number">4</span>) <span class="keyword">return</span></span></span><br><span class="line"><span class="actionscript">      <span class="comment">//2.拿到想要的结果。注意：转换字符串成json格式。之后先console.log(data)打印测试下再操作</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> data = <span class="built_in">JSON</span>.parse(<span class="keyword">this</span>.responseText)</span></span><br><span class="line"><span class="actionscript">      <span class="comment">// data =&gt; 数据</span></span></span><br><span class="line"><span class="actionscript">	  <span class="comment">//3.有了结果后就可以对它进行遍历了。写了循环后一样console.log测试下。可以挨个打印每一个对象后，就在html中动态创建个li放到ul中：给ul加个id方便操作它，在js一开始的地方把id获取到。</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.length; i++) &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">//console.log(data[i])</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">//4.在这动态创建每个li的元素，然后li放东西</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> liElement = <span class="built_in">document</span>.createElement(<span class="string">'li'</span>)</span></span><br><span class="line">        liElement.innerHTML = data[i].name</span><br><span class="line">        liElement.id = data[i].id</span><br><span class="line"><span class="actionscript">		<span class="comment">//5.把li元素放到ul中</span></span></span><br><span class="line">        listElement.appendChild(liElement)</span><br><span class="line"><span class="actionscript"><span class="comment">//6.2 客户端：给每个li元素注册点击事件</span></span></span><br><span class="line"><span class="actionscript">        liElement.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// 7.<span class="doctag">TODO:</span> 通过AJAX操作获取服务端对应数据的信息</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">// 如何获取当前被点击元素对应的数据的ID——通过创建liElement.id = data[i].id拿到</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">// console.log(this.id)</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> xhr1 = <span class="keyword">new</span> XMLHttpRequest()</span></span><br><span class="line"><span class="actionscript">          xhr1.open(<span class="string">'GET'</span>, <span class="string">'users.php?id='</span> + <span class="keyword">this</span>.id)</span></span><br><span class="line">          xhr1.send()</span><br><span class="line"><span class="actionscript">          xhr1.onreadystatechange = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !== <span class="number">4</span>) <span class="keyword">return</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> obj = <span class="built_in">JSON</span>.parse(<span class="keyword">this</span>.responseText)</span></span><br><span class="line">            alert(obj.age)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="actionscript"><span class="comment">//6.客户端：给每个li元素注册点击事件（由于不是JQ，所以要找到所以li遍历注册点击事件）。又因为 li 是后来动态创建的，而必须要创建时注册事件，所以不能这样注册事件。所以要到6.2那。</span></span></span><br><span class="line"><span class="actionscript">    <span class="comment">// for (var i = 0; i &lt; listElement.children.length; i++) &#123;</span></span></span><br><span class="line"><span class="actionscript">    <span class="comment">//   listElement.children[i].addEventListener('click', function () &#123;</span></span></span><br><span class="line"><span class="actionscript">    <span class="comment">//     console.log(111)</span></span></span><br><span class="line"><span class="actionscript">    <span class="comment">//   &#125;)</span></span></span><br><span class="line"><span class="actionscript">    <span class="comment">// &#125;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// var xhr = new XMLHttpRequest()</span></span></span><br><span class="line"><span class="actionscript">    <span class="comment">// // 这里任然是使用URL中的问号参数传递数据</span></span></span><br><span class="line"><span class="actionscript">    <span class="comment">// xhr.open('GET', 'users.php?id=2')</span></span></span><br><span class="line"><span class="actionscript">    <span class="comment">// xhr.send(null)</span></span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// xhr.onreadystatechange = function () &#123;</span></span></span><br><span class="line"><span class="actionscript">    <span class="comment">//   if (this.readyState !== 4) return</span></span></span><br><span class="line"><span class="actionscript">    <span class="comment">//   console.log(this.responseText)</span></span></span><br><span class="line"><span class="actionscript">    <span class="comment">// &#125;</span></span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//users.php的</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">header(<span class="string">'Content-Type: application/json'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// `/users.php?id=1` =&gt; id 为 1 的用户信息</span></span><br><span class="line"></span><br><span class="line">$data = <span class="keyword">array</span>(</span><br><span class="line">  <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'id'</span> =&gt; <span class="number">1</span>,</span><br><span class="line">    <span class="string">'name'</span> =&gt; <span class="string">'张三'</span>,</span><br><span class="line">    <span class="string">'age'</span> =&gt; <span class="number">18</span></span><br><span class="line">  ),</span><br><span class="line">  <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'id'</span> =&gt; <span class="number">2</span>,</span><br><span class="line">    <span class="string">'name'</span> =&gt; <span class="string">'李四'</span>,</span><br><span class="line">    <span class="string">'age'</span> =&gt; <span class="number">20</span></span><br><span class="line">  ),</span><br><span class="line">  <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'id'</span> =&gt; <span class="number">3</span>,</span><br><span class="line">    <span class="string">'name'</span> =&gt; <span class="string">'二傻子'</span>,</span><br><span class="line">    <span class="string">'age'</span> =&gt; <span class="number">18</span></span><br><span class="line">  ),</span><br><span class="line">  <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'id'</span> =&gt; <span class="number">4</span>,</span><br><span class="line">    <span class="string">'name'</span> =&gt; <span class="string">'三愣子'</span>,</span><br><span class="line">    <span class="string">'age'</span> =&gt; <span class="number">19</span></span><br><span class="line">  )</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>($_GET[<span class="string">'id'</span>])) &#123;</span><br><span class="line">  <span class="comment">// 没有 ID 获取全部</span></span><br><span class="line">  <span class="comment">// 因为 HTTP 中约定报文的内容就是字符串，而我们需要传递给客户端的信息是一个有结构的数据</span></span><br><span class="line">  <span class="comment">// 这种情况下我们一般采用 JSON 作为数据格式</span></span><br><span class="line">  $json = json_encode($data); <span class="comment">// =&gt; [&#123;"id":1,"name":"张三"&#125;,&#123;...&#125;]</span></span><br><span class="line">  <span class="keyword">echo</span> $json;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// 传递了 ID 只获取一条</span></span><br><span class="line">  <span class="keyword">foreach</span> ($data <span class="keyword">as</span> $item) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($item[<span class="string">'id'</span>] != $_GET[<span class="string">'id'</span>]) <span class="keyword">continue</span>;</span><br><span class="line">    $json = json_encode($item); <span class="comment">// =&gt; [&#123;"id":1,"name":"张三"&#125;,&#123;...&#125;]</span></span><br><span class="line">    <span class="keyword">echo</span> $json;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="POST请求及实例"><a href="#POST请求及实例" class="headerlink" title="POST请求及实例"></a>POST请求及实例</h3><blockquote>
<p>POST 请求过程中，都是采用请求体承载需要提交的数据。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest() </span><br><span class="line"><span class="comment">// open 方法的第一个参数的作用就是设置请求的 method </span></span><br><span class="line">xhr.open(<span class="string">'POST'</span>, <span class="string">'./add.php'</span>) </span><br><span class="line"><span class="comment">// 设置请求头中的 Content‐Type 为 application/x‐www‐form‐urlencoded </span></span><br><span class="line"><span class="comment">// 标识此次请求的请求体格式为 urlencoded 以便于服务端接收数据 </span></span><br><span class="line">xhr.setRequestHeader(<span class="string">'Content‐Type'</span>, <span class="string">'application/x‐www‐form‐urlencoded'</span>) <span class="comment">// 需要提交到服务端的数据可以通过 send 方法的参数传递 // 格式：key1=value1&amp;key2=value2 </span></span><br><span class="line">xhr.send(<span class="string">'key1=value1&amp;key2=value2'</span>) xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;   <span class="keyword">if</span> (<span class="keyword">this</span>.readyState === <span class="number">4</span>) &#123;     <span class="built_in">console</span>.log(<span class="keyword">this</span>.responseText)   </span><br><span class="line">	&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：实际开发中不能一会写js一会写php，一般先写好结果先测试下防止服务端出问题再写客户端功能。</p>
<blockquote>
<p>（但用浏览器直接去请求它，浏览器发的是get请求。怎么测试post请求？用个小工具Postman，它可以专门用来发各种类型请求、调试接口等。</p>
<p>测试post请求：输入.php所在网址，选post请求，多出来个body选项，点对应请求体格式，添加键值对如用户名、密码等，按send提交即可测试）</p>
<p>调试接口:输入接口地址，添加？后的参数按send</p>
</blockquote>
<p>实例：要求页面不刷新把数据提交到服务端去（用form肯定会刷新，所以用table，技术用js+ajax）。</p>
<p>这里的loading代码块可以去掉：在网络请求慢时做加载效果</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">//08-ajax-post.html</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>AJAX发送POST请求<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-id">#loading</span> &#123;</span></span><br><span class="line">      display: none;</span><br><span class="line">      position: fixed;</span><br><span class="line">      top: 0;</span><br><span class="line">      left: 0;</span><br><span class="line">      right: 0;</span><br><span class="line">      bottom: 0;</span><br><span class="line"><span class="css">      <span class="selector-tag">background-color</span>: <span class="selector-id">#555</span>;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">opacity</span>: <span class="selector-class">.5</span>;</span></span><br><span class="line">      text-align: center;</span><br><span class="line">      line-height: 300px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-id">#loading</span><span class="selector-pseudo">::after</span> &#123;</span></span><br><span class="line">      content: '加载中...';</span><br><span class="line"><span class="css">      <span class="selector-tag">color</span> : <span class="selector-id">#fff</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"loading"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">id</span>=<span class="string">"password"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"btn"</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 写客户端js有一句话：找一个合适的时机，做一件合适的事情（做任何功能时首先要考虑这个东西在什么时候去工作：登录时，工作的内容是什么：把界面上的数据通过ajax提交到服务端）</span></span></span><br><span class="line"><span class="actionscript">    <span class="comment">//0.时机：（怎么判断登陆时：通过点击按钮），所以给按钮注册点击事件</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'btn'</span>)</span></span><br><span class="line"><span class="actionscript">    <span class="comment">// 1. 事情：1.1获取界面上的元素 value </span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> txtUsername = <span class="built_in">document</span>.getElementById(<span class="string">'username'</span>)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> txtPassword = <span class="built_in">document</span>.getElementById(<span class="string">'password'</span>)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> loading = <span class="built_in">document</span>.getElementById(<span class="string">'loading'</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    btn.onclick = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="comment">//发请求就显示这个</span></span></span><br><span class="line"><span class="actionscript">      loading.style.display = <span class="string">'block'</span></span></span><br><span class="line"><span class="actionscript">      <span class="comment">//1.1获取界面上的元素 value</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> username = txtUsername.value</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> password = txtPassword.value</span></span><br><span class="line"><span class="actionscript">      <span class="comment">// 1.2 通过 XHR 发送一个 POST 请求</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span></span><br><span class="line"><span class="actionscript">      xhr.open(<span class="string">'POST'</span>, <span class="string">'login.php'</span>)</span></span><br><span class="line"><span class="actionscript">      <span class="comment">// !!! 一定注意 如果请求体是 urlencoded 格式 必须设置这个请求头 ！！！</span></span></span><br><span class="line"><span class="actionscript">      xhr.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/x-www-form-urlencoded'</span>)</span></span><br><span class="line"><span class="actionscript">      <span class="comment">// xhr.send('username=' + username + '&amp;password=' + password)</span></span></span><br><span class="line"><span class="actionscript"><span class="comment">//可以换成js中的模板字符串$&#123;变量名&#125;，可以解析变量。    xhr.send(`username=$&#123;username&#125;&amp;password=$&#123;password&#125;`)</span></span></span><br><span class="line"><span class="actionscript">      <span class="comment">// 1.3 根据服务端的反馈 作出界面提示</span></span></span><br><span class="line"><span class="actionscript">      xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !== <span class="number">4</span>) <span class="keyword">return</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.responseText)</span></span><br><span class="line"><span class="actionscript">        <span class="comment">//一般响应处理完做这些操作：请求完就关掉加载效果</span></span></span><br><span class="line"><span class="actionscript">        loading.style.display = <span class="string">'none'</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span>login.php</span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> 接收用户提交的用户名密码：校验、响应</span><br><span class="line"><span class="keyword">if</span> (empty(<span class="variable">$_POST</span>[<span class="string">'username'</span>]) || empty(<span class="variable">$_POST</span>[<span class="string">'password'</span>])) &#123;</span><br><span class="line">  <span class="regexp">//</span> echo ;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">'请提交用户名和密码'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="regexp">//</span> 校验</span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">'username'</span>];</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">'password'</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$username</span> === <span class="string">'admin'</span> &amp;&amp; <span class="variable">$password</span> === <span class="string">'123'</span>) &#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">'恭喜你登陆成功'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">exit</span>(<span class="string">'用户名或者密码错误'</span>);</span><br><span class="line"><span class="regexp">//</span> 响应</span><br></pre></td></tr></table></figure>

<h2 id="同步模式和异步模式"><a href="#同步模式和异步模式" class="headerlink" title="同步模式和异步模式"></a>同步模式和异步模式</h2><blockquote>
<p>同步：一个人在同一个时刻只能做一件事情。在执行一些耗时的操作（不需要看管）不去做别的事，只是等 待</p>
<p>异步：在执行一些耗时的操作（不需要看管）去做别的事，而不是等待</p>
</blockquote>
<p>open 方法的第三个参数是 async (异步)可以传入一个布尔值，默认为 true</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//同步、异步涉及到这段代码执行时间的长短不一样：如在这段代码前后都用console.log输出，则异步会同时执行这2个输出，同步会出现愣等（阻塞）情况导致时间慢。可以用开始秒表console.time('秒表名')、结束秒表console.timeEnd('秒表名')来计时（计算中间代码执行的时候）</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xhrAsync= <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">xhrAsync.open(<span class="string">'GET'</span>, <span class="string">'time.php'</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'async'</span>)</span><br><span class="line">xhrAsync.send()</span><br><span class="line"><span class="built_in">console</span>.log(xhrAsync.responseText)</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">'async'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同步模式 ajax 操作会有楞等的情况</span></span><br><span class="line"><span class="comment">// 区别在于 send 方法会不会出现等待情况</span></span><br><span class="line"><span class="comment">// 同步模式下send方法会直接给我们结果。一定要注意事件注册时间问题：若有事件注册，会来不及，而异步则是发send信号时，就去注册事件。</span></span><br><span class="line"><span class="comment">//不建议用同步模式，会降低用户体验。只有在封装时才有可能会使用</span></span><br><span class="line"><span class="keyword">var</span> xhrSync= <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">xhrSync.open(<span class="string">'GET'</span>, <span class="string">'time.php'</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'sync'</span>)</span><br><span class="line">xhrSync.send()</span><br><span class="line"><span class="built_in">console</span>.log(xhrSync.responseText)</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">'sync'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="响应的数据格式XML、JSON"><a href="#响应的数据格式XML、JSON" class="headerlink" title="响应的数据格式XML、JSON"></a>响应的数据格式XML、JSON</h2><p>提问：如果希望服务端返回一个复杂数据，该如何处理？</p>
<blockquote>
<p>只要涉及到响应类型不同时，服务端应就要设置上合理的Content-Type。（告诉客户端；用上JQ等时，JQ会帮忙转换，若遇到不设置的JQ应对方法如$.getJSON）</p>
<p>不管服务端采用XML还是JSON，本质上都是将数据返回给客户端</p>
</blockquote>
<ul>
<li>XML</li>
</ul>
<p>一种数据描述手段，老掉牙的东西。淘汰的原因：数据冗余太多</p>
<p>用途：ajax里、或一些程序的配置文件里有用到</p>
<blockquote>
<p>XML也可以设样式，最早的网页就是用XML做的，如网易rss</p>
</blockquote>
<p>问题在于：如果你客户端发一个AJAX请求，服务端返回个XML，那客户端怎么去解析它？了解即可</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//xml.php</span><br><span class="line">//如果想返回XML，一定要设Content-Type。否则客户端会当HTML解析</span><br><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">header(<span class="string">'Content-Type: application/xml'</span>);</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br><span class="line">//XML的文档头</span><br><span class="line"><span class="meta">&lt;?xml version="1.1" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">student</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">age</span>&gt;</span>18<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">girl_friend</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>李四<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">girl_friend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">student</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//<span class="number">11</span>-ajax-<span class="type">xml</span>.html:AJAX请求<span class="type">XML</span>格式的数据</span><br><span class="line">	var xhr = <span class="built_in">new</span> XMLHttpRequest()</span><br><span class="line">    xhr.<span class="keyword">open</span>(<span class="string">'GET'</span>, <span class="string">'xml.php'</span>)</span><br><span class="line">    xhr.send()</span><br><span class="line">    xhr.onreadystatechange = <span class="keyword">function</span> () &#123;</span><br><span class="line">      <span class="keyword">if</span> (this.readyState !== <span class="number">4</span>) <span class="keyword">return</span></span><br><span class="line">      //console.log(this.responseText)到这，能成功打印，问题是：怎么把<span class="type">xml</span>中的数据解析拿出来。应对：只打印this时this还包含了responsexml:document</span><br><span class="line">      // this.responseXML 专门用于获取服务端返回的 <span class="type">XML</span> 数据，操作方式就是通过 DOM 的方式操作</span><br><span class="line">      // 但是需要服务端响应头中的 Content-<span class="keyword">Type</span> 必须是 application/<span class="type">xml</span>。否则Content-<span class="keyword">Type</span>会被客户端认为是<span class="type">text</span>/html，则responsexml:<span class="keyword">null</span></span><br><span class="line">      console.log(this.responseXML.documentElement.children[<span class="number">0</span>].innerHTML)//张三      console.log(this.responseXML.documentElement.getElementsByTagName(<span class="string">'name'</span>)[<span class="number">0</span>])//张三</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>JSON</li>
</ul>
<p>一种数据描述手段，类似于 JavaScript 字面量方式</p>
<p>服务端采用 JSON 格式返回数据，客户端按照 JSON 格式解析数据。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="attr">"name"</span>: <span class="string">"张三"</span>,</span><br><span class="line"> <span class="attr">"age"</span>: <span class="number">18</span>,</span><br><span class="line"> <span class="attr">"girl_friend"</span>: &#123;</span><br><span class="line">	<span class="attr">"name"</span>: <span class="string">"李四"</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>不管是 JSON 也好，还是 XML，只是在 AJAX 请求过程中用到，并不代表它们之间有必然的联系，它们只是 数据协议罢了</p>
</blockquote>
<h2 id="客户端如何处理服务端响应的数据（处理响应数据渲染）"><a href="#客户端如何处理服务端响应的数据（处理响应数据渲染）" class="headerlink" title="客户端如何处理服务端响应的数据（处理响应数据渲染）"></a>客户端如何处理服务端响应的数据（处理响应数据渲染）</h2><p>学习目的：一个（有结构的）数据怎么从服务端拿回来：通过json方式。拿回来过后，在客户端这边处理很麻烦（过往：大量DOM或拼接），可以拿模板引擎去处理。</p>
<h3 id="以往操作：代码方式"><a href="#以往操作：代码方式" class="headerlink" title="以往操作：代码方式"></a>以往操作：代码方式</h3><p>动态渲染数据到表格中案例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">//12-ajax-table.html</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tbody</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span><span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span></span><br><span class="line"><span class="actionscript">    xhr.open(<span class="string">'GET'</span>, <span class="string">'test.php'</span>)</span></span><br><span class="line">    xhr.send()</span><br><span class="line"><span class="actionscript">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !== <span class="number">4</span>) <span class="keyword">return</span></span></span><br><span class="line"><span class="actionscript">      <span class="comment">//console.log(this.responseText)就能拿到JSON，直接把它转换解析了拿到服务端返回的结果res</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> res = <span class="built_in">JSON</span>.parse(<span class="keyword">this</span>.responseText)</span></span><br><span class="line"><span class="actionscript">      <span class="comment">// res =&gt; 服务端返回的结果</span></span></span><br><span class="line"><span class="actionscript">      <span class="comment">//再拿到res对象里的data数据，我们真正要遍历的数据</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> data = res.data </span></span><br><span class="line"><span class="actionscript">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.length; i++) &#123;</span></span><br><span class="line"><span class="actionscript">       <span class="comment">// console.log(data[i]) 拿到数据的每一行需要显示的东西</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">// 用创建的方式</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">// 先创建行</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">// 再创建列</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">// 再将列添加到行</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">// 再将行添加到tbody</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> tr = <span class="built_in">document</span>.createElement(<span class="string">'tr'</span>)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> td = <span class="built_in">document</span>.createElement(<span class="string">'td'</span>)</span></span><br><span class="line">        td.innerHTML = data[i].id</span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> td = <span class="built_in">document</span>.createElement(<span class="string">'td'</span>)</span></span><br><span class="line">        td.innerHTML = data[i].id</span><br><span class="line">        ...</span><br><span class="line">        tr.append...</span><br><span class="line">        ...</span><br><span class="line"><span class="actionscript">        <span class="comment">// 或用innerHTML拼接的方式</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> tr = <span class="built_in">document</span>.createElement(<span class="string">'tr'</span>)</span></span><br><span class="line"><span class="handlebars"><span class="xml">        tr.innerHTML = '<span class="tag">&lt;<span class="name">td</span>&gt;</span>' + data[i].id + '<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span>'</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>到了以后学到agule、vue就不会写这些东西了：大量DOM操作、拼接，连整个document都不用再写了</p>
<h3 id="模板方式"><a href="#模板方式" class="headerlink" title="模板方式"></a>模板方式</h3><p>一个（有结构的）数据怎么从服务端拿回来：通过json方式。拿回来过后，在客户端这边处理很麻烦，可以拿模板引擎去处理。</p>
<p>采用技术：模板引擎。目的：更容易将数据渲染到html中</p>
<p>核心：给我个数据，给我个模板，我根据一个规则帮你执行完得到一个结果</p>
<blockquote>
<p>实际并不陌生，php就好像个大号的模板引擎（与HTML混编才不觉得恶心），在服务端做的。</p>
</blockquote>
<p>客户端开发技术：也有个模板引擎——如artTemplate：<a href="https://aui.github.io/art-template/，国内的，最重要的一点：有中文文档（切换语言再点文档按钮）。自己去熟悉" target="_blank" rel="noopener">https://aui.github.io/art-template/，国内的，最重要的一点：有中文文档（切换语言再点文档按钮）。自己去熟悉</a></p>
<p>​    用法：把一个js文件引到页面当中，先写一个模板，写完模板之后准备一个数据，把数据跟模板同时扔到一个js文件所提供的一个方式里，就可以出结果了。</p>
<p>​    中文文档-安装-在浏览器中实时编译-下载js-保存起来。然后到页面当中去引用这个文件，再用script的方式去定义模板。</p>
<p>学东西的套路：照着手册一步步学</p>
<p>常见的流行模板引擎：Jade/pug、Handlebars、ejs、Nunjucks。用法都一样，看的就是一个套路。（一般选用一个东西：根据它在github上的活跃程度、协议、加星程度、关注程度一系列数字去决定）</p>
<p>参考：github.com/tj/consolidate.js#supported-template-engines（做node开发一个比较出名的作者做的常见模板引擎列表）</p>
<h4 id="使用模板引擎动态渲染表格实例"><a href="#使用模板引擎动态渲染表格实例" class="headerlink" title="使用模板引擎动态渲染表格实例"></a>使用模板引擎动态渲染表格实例</h4><blockquote>
<p>1.选择一个模板引擎     https:github.com/tj/consolidate.js#supported-template-engines<br>2.下载模板引擎JS文件<br>3.引入到页面中<br>4.准备一个模板<br>5.准备一个数据<br>6.通过模板引擎的JS提供的一个函数将模板和数据整合得到渲染结果HTML<br>7.将渲染结果HTML 设置到 默认元素的 innerHTML 中</p>
<pre><code>注意：
一、script 标签的特点是（模板引擎盯上了）
1. innerHTML 永远不会显示在界面上
    2. 如果 type 不等于 text/javascript 的话，内部的内容不会作为 JavaScript 执行</code></pre><p>二、为什么不在JS变量中写模板？<br>        如果将模板写到JS中，维护不方便，不能换行，没有着色。如var tmpl = ‘{{if user}}<h2>{{user.name}}</h2>{{/if}}‘<br> 三、为什么使用script标记写模板？<br>        script不会显示在界面</p>
</blockquote>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">"demo"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="comment">&lt;!--4的，建议type这样写,其它模板引擎就text/x-... --&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">"tmpl"</span> <span class="attr">type</span>=<span class="string">"text/x-art-template"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    //该模板引擎的遍历方法</span></span><br><span class="line"><span class="xml">    </span><span class="template-variable">&#123;&#123;<span class="builtin-name">each</span> comments&#125;&#125;</span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- each 内部 $value 拿到的是当前被遍历的那个元素。 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><span class="template-variable">&#123;&#123;$value.author&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><span class="template-variable">&#123;&#123;$value.content&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><span class="template-variable">&#123;&#123;$value.created&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">&#123;&#123;/<span class="name"><span class="builtin-name">each</span></span>&#125;&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span></span><br><span class="line"><span class="xml">  <span class="comment">&lt;!--3的--&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"template-web.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml">    var xhr = new XMLHttpRequest()</span></span><br><span class="line"><span class="xml">    xhr.open('GET', 'test.php')</span></span><br><span class="line"><span class="xml">    xhr.send()</span></span><br><span class="line"><span class="xml">    xhr.onreadystatechange = function () &#123;</span></span><br><span class="line"><span class="xml">      if (this.readyState !== 4) return</span></span><br><span class="line"><span class="xml">//5的</span></span><br><span class="line"><span class="xml">      var res = JSON.parse(this.responseText)</span></span><br><span class="line"><span class="xml">      // 模板所需数据</span></span><br><span class="line"><span class="xml">      var context = &#123; comments: res.data &#125;</span></span><br><span class="line"><span class="xml">      // 6的：借助模板引擎的API 渲染数据，参数：模板标记的id，数据</span></span><br><span class="line"><span class="xml">      var html = template('tmpl', context)</span></span><br><span class="line"><span class="xml">      console.log(html)//-&gt;渲染过后的结果</span></span><br><span class="line"><span class="xml">      //7的</span></span><br><span class="line"><span class="xml">      document.getElementById('demo').innerHTML = html</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br></pre></td></tr></table></figure>



<h2 id="XMLHttpRequest的兼容方案（面试）"><a href="#XMLHttpRequest的兼容方案（面试）" class="headerlink" title="XMLHttpRequest的兼容方案（面试）"></a>XMLHttpRequest的兼容方案（面试）</h2><p>XMLHttpRequest 在老版本浏览器（<strong>IE5/6</strong>）中有兼容问题，可以通过另外一种方式代替（三元表达式判断一下支持、不支持）</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = window.XMLHttpRequest ? <span class="keyword">new</span><span class="type"></span> XMLHttpRequest() :<span class="type"></span> <span class="keyword">new</span><span class="type"></span> ActiveXObject(<span class="string">'Microsoft.XMLHTTP'</span>)</span><br></pre></td></tr></table></figure>

<p>面试时考ajax时一定把这点写上，ajax考的就是这点</p>
<h2 id="AJAX的封装"><a href="#AJAX的封装" class="headerlink" title="AJAX的封装"></a>AJAX的封装</h2><p>封装的套路：</p>
<ol>
<li><p>写一个相对比较完善的用例</p>
</li>
<li><p>写一个空函数，没有形参，将刚刚的用例直接作为函数的函数体</p>
</li>
<li><p>根据使用过程中的<strong>需求</strong>抽象参数</p>
</li>
</ol>
<p>接下来开始进行封装</p>
<p>1.写一个相对比较完善的用例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">xhr.open(<span class="string">'GET'</span>,<span class="string">'time.php'</span>)</span><br><span class="line">xhr.send(<span class="literal">null</span>)</span><br><span class="line">xhr.onreadstatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.readyState !==<span class="number">4</span>) <span class="keyword">return</span></span><br><span class="line">	<span class="built_in">console</span>.log(<span class="keyword">this</span>.responseText)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.写一个空函数funcion ajax(){}，没有形参，将刚刚的用例直接作为函数的函数体。到这就能调用ajax()了，但到这只是最基本的封装，差得还很远</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">funcion ajax()&#123;</span><br><span class="line">	<span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">    xhr.open(<span class="string">'GET'</span>,<span class="string">'time.php'</span>)</span><br><span class="line">    xhr.send(<span class="literal">null</span>)</span><br><span class="line">    xhr.onreadstatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !==<span class="number">4</span>) <span class="keyword">return</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.responseText)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//调用</span></span><br><span class="line">ajax()</span><br></pre></td></tr></table></figure>

<p>3.<strong>根据</strong>使用过程中的*<em>需求 *</em>抽象参数</p>
<p>版本1：</p>
<p>根据不同的需求：open的请求方式、地址会发生变化；当请求方式为POST，send的参数会变化；所以要把它们从写死的状态换成一个传入的参数。method(问题：当open请求方式是小写也能传入，我们的封装代码却不能正常执行，所以要转大写。), url, params(问题1：当传入第三个参数时，下面的调用1也要有对应的参数null。但调用1要也要写参数麻烦-&gt;最好有个默认值var params=params||null。问题2:params传入urlencoded型数据时需要告诉服务端Content-Type，要设置响应头-&gt;必须要有个设置操作xhr.setRequestHeader(‘Content-Type’, ‘application/x-www-form-urlencoded’)。问题2.1：不为POST请求时，不设置响应头-&gt;给个判断,但到这里发现send参数的设置就不大好了，所以优化掉，进入版本2)</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">funcion ajax(<span class="function"><span class="keyword">method</span>, <span class="title">url</span>, <span class="title">params</span>)<span class="comment">&#123;</span></span></span><br><span class="line"><span class="function"><span class="comment">	method = method.toUpperCase()</span></span></span><br><span class="line"><span class="function"><span class="comment">	var xhr = new XMLHttpRequest()</span></span></span><br><span class="line"><span class="function"><span class="comment">    xhr.open(method, url)</span></span></span><br><span class="line"><span class="function"><span class="comment">    if (method === 'POST') &#123;</span></span></span><br><span class="line"><span class="function"><span class="comment">    	xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')</span></span></span><br><span class="line"><span class="function"><span class="comment">    &#125;</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">    <span class="title">var</span> <span class="title">params</span> = <span class="title">params</span> || <span class="title">null</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">    <span class="title">xhr</span>.<span class="title">send</span><span class="params">(<span class="keyword">params</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">xhr</span>.<span class="title">onreadstatechange</span> = <span class="title">function</span> <span class="params">()</span> <span class="comment">&#123;</span></span></span><br><span class="line"><span class="function"><span class="comment">        if (this.readyState !==4) return</span></span></span><br><span class="line"><span class="function"><span class="comment">        console.log(this.responseText)</span></span></span><br><span class="line"><span class="function"><span class="comment">    &#125;</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function">//调用</span></span><br><span class="line"><span class="function"><span class="title">ajax</span><span class="params">(<span class="string">'GET'</span>, <span class="string">'time.php'</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">ajax</span><span class="params">(<span class="string">'POST'</span>, <span class="string">'add.php'</span>, <span class="string">'key1=value1&amp;key2=value2'</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">ajax</span><span class="params">(<span class="string">'get'</span>, <span class="string">'time.php'</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">ajax</span><span class="params">(<span class="string">'post'</span>, <span class="string">'add.php'</span>, <span class="string">'key1=value1&amp;key2=value2'</span>)</span></span></span><br></pre></td></tr></table></figure>

<p>版本2：也是基本封装，只是相对完善</p>
<p>参数params的问题1.1：params设置优化——如果不是POST请求就永远是null，是POST就取params；如果是get请求，除了null也有可能传参数（如id这参数放url里），所以要对url进行处理。</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">funcion ajax(method, <span class="built_in">url</span>, params)&#123;</span><br><span class="line">	method = method.toUpperCase()</span><br><span class="line">	<span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> (method === <span class="string">'GET'</span>) &#123;</span><br><span class="line">      <span class="built_in">url</span> += <span class="string">'?'</span> + params</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    xhr.open(method, <span class="built_in">url</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> data = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">    	xhr.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/x-www-form-urlencoded'</span>)</span><br><span class="line">    	data = params</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    xhr.send(data)</span><br><span class="line">    xhr.onreadstatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !==<span class="number">4</span>) <span class="keyword">return</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.responseText)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//调用</span></span><br><span class="line">ajax(<span class="string">'GET'</span>, <span class="string">'time.php'</span>,<span class="string">'id=1'</span>)</span><br><span class="line">ajax(<span class="string">'POST'</span>, <span class="string">'add.php'</span>, <span class="string">'key1=value1&amp;key2=value2'</span>)</span><br></pre></td></tr></table></figure>

<p>版本3：</p>
<p>问题1：上个版本中params传入参数是像key1=value1&amp;key2=value2这样结构，看着太恶心写起来也麻烦，所以改进：希望params传入的是个对象而不是字符串。而调用时直接传入对象查看Network请求不行，所以要把params（的对象实参）转成key1=value1&amp;key2=value2这样格式</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">funcion <span class="title">ajax</span>(<span class="params">method, url, <span class="keyword">params</span></span>)</span>&#123;</span><br><span class="line">	method = method.toUpperCase()</span><br><span class="line">	<span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">params</span> === <span class="string">'object'</span>) &#123;</span><br><span class="line">		<span class="keyword">var</span> tempArr = []</span><br><span class="line">		<span class="comment">//遍历对象的每一个键</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> <span class="keyword">params</span>) &#123;</span><br><span class="line">		   <span class="comment">//拿到它每一个值</span></span><br><span class="line">           <span class="keyword">var</span> <span class="keyword">value</span> = <span class="keyword">params</span>[key]</span><br><span class="line">           <span class="comment">//把每对键值拼接起来：tempArr =&gt; [ 'key1=value1', 'key2=value2' ]</span></span><br><span class="line">           tempArr.push(key + <span class="string">'='</span> + <span class="keyword">value</span>)</span><br><span class="line">           <span class="comment">//要得到格式：params =&gt; 'key1=value1&amp;key2=value2'。所以要join连接起来</span></span><br><span class="line">           <span class="keyword">params</span> = tempArr.<span class="keyword">join</span>(<span class="string">'&amp;'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> (method === <span class="string">'GET'</span>) &#123;</span><br><span class="line">      url += <span class="string">'?'</span> + <span class="keyword">params</span></span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    xhr.open(method, url)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> data = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">    	xhr.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/x-www-form-urlencoded'</span>)</span><br><span class="line">    	data = <span class="keyword">params</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    xhr.send(data)</span><br><span class="line">    xhr.onreadstatechange = function () &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !==<span class="number">4</span>) <span class="keyword">return</span></span><br><span class="line">        console.log(<span class="keyword">this</span>.responseText)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//调用</span></span><br><span class="line">ajax(<span class="string">'GET'</span>, <span class="string">'time.php'</span>,&#123; id: <span class="number">1</span> &#125;)</span><br><span class="line">ajax(<span class="string">'POST'</span>, <span class="string">'add.php'</span>, &#123; key1: <span class="string">'value1'</span>,key2: <span class="string">'value2'</span> &#125;)</span><br></pre></td></tr></table></figure>

<p>版本4：</p>
<p>核心问题：不应该在封装的函数中主观地处理响应结果（把我们之前写的console.log()去掉，alert()也不能写），所以要有返回值。</p>
<blockquote>
<p>但无法在内部包含的函数中通过return  给外部函数的调用返回结果，所以要用作用链的方式拿到返回值：</p>
<p>function foo () {<br>    var res<br>    function bar () {<br>    res = 123<br>    }<br>    bar()<br>    return res<br>}</p>
</blockquote>
<p>但又引起来了新的问题：代码执行顺序：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">funcion <span class="title">ajax</span>(<span class="params">method, url, <span class="keyword">params</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> res = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">	method = method.toUpperCase()</span><br><span class="line">	<span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">params</span> === <span class="string">'object'</span>) &#123;</span><br><span class="line">		<span class="keyword">var</span> tempArr = []</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> <span class="keyword">params</span>) &#123;</span><br><span class="line">           <span class="keyword">var</span> <span class="keyword">value</span> = <span class="keyword">params</span>[key]</span><br><span class="line">           tempArr.push(key + <span class="string">'='</span> + <span class="keyword">value</span>)</span><br><span class="line">           <span class="keyword">params</span> = tempArr.<span class="keyword">join</span>(<span class="string">'&amp;'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> (method === <span class="string">'GET'</span>) &#123;</span><br><span class="line">      url += <span class="string">'?'</span> + <span class="keyword">params</span></span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    xhr.open(method, url)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> data = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">    	xhr.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/x-www-form-urlencoded'</span>)</span><br><span class="line">    	data = <span class="keyword">params</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    xhr.send(data)</span><br><span class="line">    xhr.onreadstatechange = function () &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !==<span class="number">4</span>) <span class="keyword">return</span></span><br><span class="line">        <span class="comment">//不应该在封装的函数中主观的处理响应结果</span></span><br><span class="line">     	<span class="comment">//console.log(this.responseText)</span></span><br><span class="line">        <span class="comment">//无法在内部包含的函数中通过 return 给外部函数的调用返回结果</span></span><br><span class="line">        <span class="comment">// return this.responseText</span></span><br><span class="line">		<span class="comment">// 由于异步模式下（这儿代码刚开始执行外部代码比这儿早且仍在执行） 这里的代码最后执行 所以不可能在外部通过返回值的方式返回数据</span></span><br><span class="line">		<span class="comment">//用同步：oepn参数加个false，且事件移到send前。但强烈拒绝使用，所以到这代码就写不下去了。就要用到js的一个操作：委托（回调）</span></span><br><span class="line">		res = <span class="keyword">this</span>.responseText</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//调用</span></span><br><span class="line">ajax(<span class="string">'GET'</span>, <span class="string">'time.php'</span>,&#123; id: <span class="number">1</span> &#125;)</span><br><span class="line">ajax(<span class="string">'POST'</span>, <span class="string">'add.php'</span>, &#123; key1: <span class="string">'value1'</span>,key2: <span class="string">'value2'</span> &#125;)</span><br></pre></td></tr></table></figure>

<p>版本5：最终版，未成形</p>
<p>由于版本4的方向错误，所以回到版本4前，回到开始的问题是：不应该在封装的函数中主观的处理响应结果（即封装者不能去主观地处理调用者的事情，如console.log就不行）-&gt;版本4用返回值的做法不行，无法返回-&gt;怎么样不主观：你告诉我该做什么事情。用委托（js中叫回调）：即调用者委托（让）封装者拿到数据后，<strong>再告诉封装者拿着数据去做什么事情</strong>-&gt;参数4：done</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 封装者</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span> (<span class="params">method, url, params, done</span>) </span>&#123;</span><br><span class="line">   method = method.toUpperCase()</span><br><span class="line">   <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">typeof</span> params === <span class="string">'object'</span>) &#123;</span><br><span class="line">     <span class="keyword">var</span> tempArr = []</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> params) &#123;</span><br><span class="line">        <span class="keyword">var</span> value = params[key]</span><br><span class="line">        tempArr.push(key + <span class="string">'='</span> + value)</span><br><span class="line">      &#125;</span><br><span class="line">      params = tempArr.join(<span class="string">'&amp;'</span>)</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (method === <span class="string">'GET'</span>) &#123;</span><br><span class="line">        <span class="built_in">url</span> += <span class="string">'?'</span> + params</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     xhr.open(method, <span class="built_in">url</span>, <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">     <span class="keyword">var</span> data = <span class="literal">null</span></span><br><span class="line">     <span class="keyword">if</span> (method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">       xhr.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/x-www-form-urlencoded'</span>)</span><br><span class="line">       data = params</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !== <span class="number">4</span>) <span class="keyword">return</span></span><br><span class="line">       <span class="comment">// 不应该在封装的函数中主观的处理响应结果</span></span><br><span class="line">       <span class="comment">// console.log(this.responseText)</span></span><br><span class="line">       <span class="comment">// 你说我太主观，那么你告诉我应该做什么</span></span><br><span class="line">       done(<span class="keyword">this</span>.responseText)</span><br><span class="line">     &#125;</span><br><span class="line">     xhr.send(data)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 调用者,这儿分步骤好理解</span></span><br><span class="line">   <span class="keyword">var</span> onDone = <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'hahahahaha'</span>)</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'hohohohoho'</span>)</span><br><span class="line">     <span class="built_in">console</span>.log(res)</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'做完了'</span>)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   ajax(<span class="string">'get'</span>, <span class="string">'time.php'</span>, &#123;&#125;, onDone)</span><br><span class="line">   <span class="comment">//实际调用写</span></span><br><span class="line">   ajax(<span class="string">'get'</span>, <span class="string">'time.php'</span>, &#123;&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'hahahahaha'</span>)</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'hohohohoho'</span>)</span><br><span class="line">     <span class="built_in">console</span>.log(res)</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'做完了'</span>)</span><br><span class="line">   &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="最终版"><a href="#最终版" class="headerlink" title="最终版"></a>最终版</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**  * 发送一个 AJAX 请求  * <span class="doctag">@param  <span class="type">&#123;String&#125;</span>   </span>method 请求方法  * <span class="doctag">@param  <span class="type">&#123;String&#125;</span>   </span>url    请求地址  * <span class="doctag">@param  <span class="type">&#123;Object&#125;</span>   </span>params 请求参数  * <span class="doctag">@param  <span class="type">&#123;Function&#125;</span> </span>done   请求完成过后需要做的事情（委托/回调）  */</span> <span class="function"><span class="keyword">function</span> <span class="title">ajax</span> (<span class="params">method, url, params, done</span>) </span>&#123;   <span class="comment">// 统一转换为大写便于后续判断   method = method.toUpperCase()   </span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">// 对象形式的参数转换为 urlencoded 格式   var pairs = []   </span></span><br><span class="line"> <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> params) &#123;     pairs.push(key + <span class="string">'='</span> + params[key])   </span><br><span class="line"> &#125;   </span><br><span class="line"> <span class="keyword">var</span> querystring = pairs.join(<span class="string">'&amp;'</span>)     </span><br><span class="line"> 	<span class="keyword">var</span> xhr = <span class="built_in">window</span>.XMLHttpRequest ? <span class="keyword">new</span> XMLHttpRequest() : <span class="keyword">new</span>  ActiveXObject(<span class="string">'Microsoft.XMLHTTP'</span>)  </span><br><span class="line"> 		 xhr.addEventListener(<span class="string">'readystatechange'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;     </span><br><span class="line"> 	<span class="keyword">if</span> (<span class="keyword">this</span>.readyState !== <span class="number">4</span>) <span class="keyword">return</span>      </span><br><span class="line"> 	<span class="comment">// 尝试通过 JSON 格式解析响应体     </span></span><br><span class="line"> 	<span class="keyword">try</span> &#123;       </span><br><span class="line"> 		done(<span class="built_in">JSON</span>.parse(<span class="keyword">this</span>.responseText))     &#125; <span class="keyword">catch</span> (e) &#123;       </span><br><span class="line"> 		done(<span class="keyword">this</span>.responseText)     </span><br><span class="line"> 		&#125;   </span><br><span class="line"> 	&#125;)     </span><br><span class="line"> </span><br><span class="line"> <span class="comment">// 如果是 GET 请求就设置 URL 地址 问号参数   if (method === 'GET') &#123;     url += '?' + querystring   </span></span><br><span class="line">  &#125;  </span><br><span class="line">  </span><br><span class="line">  xhr.open(method, url)  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 如果是 POST 请求就设置请求体   </span></span><br><span class="line">  <span class="keyword">var</span> data = <span class="literal">null</span>  </span><br><span class="line">  <span class="keyword">if</span> (method === <span class="string">'POST'</span>) &#123;     xhr.setRequestHeader(<span class="string">'Content‐Type'</span>, <span class="string">'application/x‐www‐form‐urlencoded'</span>)     data = querystring   </span><br><span class="line">  &#125;   </span><br><span class="line">  xhr.send(data) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ajax(<span class="string">'get'</span>, <span class="string">'./get.php'</span>, &#123; <span class="attr">id</span>: <span class="number">123</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;   </span><br><span class="line">	<span class="built_in">console</span>.log(data) </span><br><span class="line">&#125;)  </span><br><span class="line">ajax(<span class="string">'post'</span>, <span class="string">'./post.php'</span>, &#123; <span class="attr">foo</span>: <span class="string">'posted data'</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;   </span><br><span class="line">	<span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>但一般我们都是使用别人封装好的，功能比较完善。</p>
<p>jQuery 中有一套专门针对 AJAX 的封装，功能十分完善，经常使用，需要着重注意。1.几版兼容性最好，3.几最新。简单使用可看code，详细看下面官方手册。</p>
<p>这些（原生、封装）API记住使用过程就好。</p>
<p>参考：<br><a href="http://www.jquery123.com/category/ajax/" target="_blank" rel="noopener">http://www.jquery123.com/category/ajax/</a></p>
<p><a href="http://www.w3school.com.cn/jquery/jquery_ref_ajax.asp" target="_blank" rel="noopener">http://www.w3school.com.cn/jquery/jquery_ref_ajax.asp</a></p>
<h2 id="回调"><a href="#回调" class="headerlink" title="回调"></a>回调</h2><p>简单实例</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">getTimestamp</span> <span class="params">(done)</span> </span>&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      setTimeout(<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// 执行调用者指定的事情</span></span></span><br><span class="line"><span class="javascript">        done(<span class="built_in">Date</span>.now())</span></span><br><span class="line"></span><br><span class="line">      &#125;, 1000)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// ========================================</span></span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 指定拿到数据过后怎么做</span></span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> done = <span class="function"><span class="keyword">function</span> <span class="params">(timestamp)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(timestamp / <span class="number">1000</span> / <span class="number">60</span> / <span class="number">60</span>)</span></span><br><span class="line">    &#125;</span><br><span class="line">    getTimestamp(done)</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>js核心：回调</p>
<h3 id="回调的嵌套情况"><a href="#回调的嵌套情况" class="headerlink" title="回调的嵌套情况"></a>回调的嵌套情况</h3><p>以后的js代码可能会出现这种情况：需要请求一个a地址，拿到响应的结果之后再去请求b地址-&gt;那么代码中会出现回调函数中可能会再出现ajax，如下面这种恶心的结构：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>)<span class="comment">//第1次执行</span></span><br><span class="line">ajax(<span class="string">'time.php'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>)<span class="comment">//第3次执行</span></span><br><span class="line">  ajax(<span class="string">'time.php'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">    ajax(<span class="string">'time.php'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">      ajax(<span class="string">'time.php'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        ajax(<span class="string">'time.php'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">          ajax(<span class="string">'time.php'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">4</span>)<span class="comment">//第4次执行</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span>)<span class="comment">//第2次执行</span></span><br></pre></td></tr></table></figure>

<p>那么可能会有这样的方案：（then然后）</p>
<figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ajax(<span class="string">'time.php'</span>)</span><br><span class="line">  .<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span> <span class="params">(res)</span> &#123;</span></span><br><span class="line">    <span class="keyword">return</span> ajax(<span class="string">'time.php'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span> <span class="params">(res)</span> &#123;</span></span><br><span class="line">    <span class="keyword">return</span> ajax(<span class="string">'time.php'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span> <span class="params">(res)</span> &#123;</span></span><br><span class="line">    <span class="keyword">return</span> ajax(<span class="string">'time.php'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span> <span class="params">(res)</span> &#123;</span></span><br><span class="line">    <span class="keyword">return</span> ajax(<span class="string">'time.php'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="comment">//注意回调黑洞（死循环）问题，如：</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">load</span> <span class="params">()</span> &#123;</span></span><br><span class="line">  ajax(<span class="string">'time.php'</span>, <span class="built_in">load</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JQ的ajax"><a href="#JQ的ajax" class="headerlink" title="JQ的ajax"></a>JQ的ajax</h2><p>$.ajax、$.get、$.post、$.getJSON、load方法、$.getScript</p>
<p>如</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(<span class="string">'./time.php'</span>, &#123;</span><br><span class="line">  type: <span class="string">'post'</span>, <span class="comment">// method 请求方法</span></span><br><span class="line">  success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// res =&gt; 拿到的只是响应体</span></span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="JQ的load方法-局部刷新"><a href="#JQ的load方法-局部刷新" class="headerlink" title="JQ的load方法(局部刷新)"></a>JQ的load方法(局部刷新)</h2><p>实现页面的  局部刷新 效果，能节省请求，如不用再请求css、js等文件</p>
<p>在jQuery封装的ajax下。跟ajax关系不大，但是用ajax实现的</p>
<p>在某一个div或元素中面去载入另外一个页面的另外一个区域</p>
<p>实例：局部刷新（加载）、在页面上做一些加载提示</p>
<p>如何做得更好？切换时希望知道在加载过程中。看下栏</p>
<h3 id="全局事件处理函数"><a href="#全局事件处理函数" class="headerlink" title="全局事件处理函数"></a>全局事件处理函数</h3><p>全局事件处理函数作用：如将所有ajax请求的公共操作注册成ajax的全局事件，让它只要发ajax请求就去自动帮我们执行</p>
<p>参考：<a href="http://www.jquery123.com/category/ajax/global-ajax-event-handlers/" target="_blank" rel="noopener">http://www.jquery123.com/category/ajax/global-ajax-event-handlers/</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  $(<span class="function"><span class="keyword">function</span> (<span class="params">$</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">     $(<span class="built_in">document</span>)</span></span><br><span class="line"><span class="actionscript">       .ajaxStart(<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">         <span class="comment">// 只要有 ajax 请求发生 就会执行</span></span></span><br><span class="line"><span class="javascript">        $(<span class="string">'.loading'</span>).fadeIn()</span></span><br><span class="line"><span class="actionscript">         <span class="comment">// 显示加载提示</span></span></span><br><span class="line"><span class="javascript">         <span class="built_in">console</span>.log(<span class="string">'注意即将要开始请求了'</span>)</span></span><br><span class="line">       &#125;)</span><br><span class="line"><span class="actionscript">       .ajaxStop(<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">         <span class="comment">// 只要有 ajax 请求结束 就会执行</span></span></span><br><span class="line"><span class="javascript">         $(<span class="string">'.loading'</span>).fadeOut()</span></span><br><span class="line"><span class="actionscript">         <span class="comment">// 结束提示</span></span></span><br><span class="line"><span class="javascript">         <span class="built_in">console</span>.log(<span class="string">'请求结束了'</span>)</span></span><br><span class="line">       &#125;)</span><br><span class="line"></span><br><span class="line"><span class="javascript">    $(<span class="string">'.list-group-item'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> url = $(<span class="keyword">this</span>).attr(<span class="string">'href'</span>)</span></span><br><span class="line"><span class="javascript">      $(<span class="string">'#main'</span>).load(url + <span class="string">' #main &gt; *'</span>)</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> <span class="literal">false</span> </span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="最常见的加载进度方式"><a href="#最常见的加载进度方式" class="headerlink" title="最常见的加载进度方式"></a>最常见的加载进度方式</h3><p>配合NProgress显示加载进度。</p>
<p>github、知乎等都有在用：只在网址栏下面走进度条——请求响应，响应结果完就一下过了。</p>
<p>要想用：有个NProgress库——使用其中的js、css文件。且最好都在页头引入。</p>
<h2 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h2><p>跨域实际跟ajax无关。</p>
<p>过去不支持不同源地址之前的ajax请求，现在支持了（存在兼容、需要服务端进行一些配置），但我们仍要了解。</p>
<p>同源策略是浏览器的一种<strong>安全策略</strong>。所谓同源是指<strong>域名，协议，端口完全相同</strong>，只有同源的地址才可以相互通过 AJAX 的方式请求。</p>
<p>同源或者不同源说的是两个地址之间的关系，不同源地址之间请求我们称之为<strong>跨域请求</strong></p>
<blockquote>
<p>之前学的能自动发送请求的方式：img、link、script、iframe。表单、a连接要点或做些操作才能</p>
<p>iframe:浏览器自带的功能，在页面中挖一个坑去载入另一个页面，跟load类似（而load是通过ajax、自己代码实现的）。</p>
</blockquote>
<p>如何解决：通过JSONP技巧</p>
<h3 id="JSONP技巧"><a href="#JSONP技巧" class="headerlink" title="JSONP技巧"></a>JSONP技巧</h3><p>JSON with Padding，是一种借助于 script 标签发送跨域请求的技巧。</p>
<p>原理：客户端通过 script 标签请求服务端的 一个动态网页(如php文件)。该文件返回一段 能调用一个函数的JS。该JS作用：<strong>调用</strong>我们事先定义好的一个<strong>函数</strong>，从而将服务端想要给客户端发过去的<strong>数据发送给客户端</strong></p>
<blockquote>
<p>注意：1. JSONP 需要服务端配合，服务端按照客户端的要求返回一段 JavaScript 调用客户端的函数<br>2.只能发送 GET 请求<br>3.jQuery 中使用 JSONP 就是将 dataType 设置为 jsonp<br>4.其他常见的 AJAX 封装 库：Axios</p>
</blockquote>
<p>实例：server.php、client.html（较多）</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span>server.php</span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line"><span class="variable">$conn</span> = mysqli_connect(<span class="string">'localhost'</span>, <span class="string">'root'</span>, <span class="string">'123456'</span>, <span class="string">'demo'</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$query</span> = mysqli_query(<span class="variable">$conn</span>, <span class="string">'select * from users'</span>);</span><br><span class="line"><span class="regexp">//</span>这儿的<span class="variable">$data</span>就是我们想要的数据。数据库代码写完进网页看能否正常请求或用Postman</span><br><span class="line"><span class="keyword">while</span> (<span class="variable">$row</span> = mysqli_fetch_assoc(<span class="variable">$query</span>)) &#123;</span><br><span class="line">  <span class="variable">$data</span>[] = <span class="variable">$row</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> 如果客户端采用的是 script 标记对我发送的请求</span><br><span class="line"><span class="regexp">//</span> 一定要返回一段 JavaScript</span><br><span class="line"><span class="regexp">//</span> 输出的内容不能再是普通的json字符串了，而要在外面包裹一个函数的调用。注意：这里客户端指定函数名字aaabbb</span><br><span class="line">header(<span class="string">'Content-Type: application/javascript'</span>);</span><br><span class="line"><span class="variable">$result</span> = json_encode(<span class="variable">$data</span>);</span><br><span class="line"><span class="regexp">//</span>echo <span class="string">"aaabbb(&#123;$result&#125;)"</span>;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>如果没有传入callback参数不想以jsonp方式操作，就设json支持普通方式，不然继续往下走</span><br><span class="line"><span class="keyword">if</span> (empty(<span class="variable">$_GET</span>[<span class="string">'callback'</span>])) &#123;</span><br><span class="line">  header(<span class="string">'Content-Type: application/json'</span>);</span><br><span class="line">  echo json_encode(<span class="variable">$data</span>);</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>服务端接收随机函数名。注意：关联数组必须要写花括号。</span><br><span class="line"><span class="regexp">//</span>echo <span class="string">"&#123;$_GET['callback']&#125;(&#123;$result&#125;)"</span>;</span><br><span class="line"><span class="regexp">//</span>优化：若明确定义了函数，采取调用函数，就不会报错。</span><br><span class="line"><span class="variable">$callback_name</span> = <span class="variable">$_GET</span>[<span class="string">'callback'</span>];</span><br><span class="line">echo <span class="string">"typeof &#123;$callback_name&#125; === 'function' &amp;&amp; &#123;$callback_name&#125;(&#123;$result&#125;)"</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">//client.html JSONP基本使用</span><br><span class="line">//在客户端发起跨域请求</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="comment">//var script = //document.createElement('script')</span></span></span><br><span class="line"><span class="actionscript"><span class="comment">//script.src = 'http://localhost/jsonp/server.php'</span></span></span><br><span class="line"><span class="actionscript"><span class="comment">//document.body.appendChild(script)</span></span></span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="comment">////准备一个函数，让服务端去调用</span></span></span><br><span class="line"><span class="actionscript"><span class="comment">//function aaabbb (data) &#123;</span></span></span><br><span class="line"><span class="actionscript"><span class="comment">//   console.log('1111', data)</span></span></span><br><span class="line"><span class="actionscript"><span class="comment">//&#125;</span></span></span><br><span class="line"><span class="actionscript"><span class="comment">//但以上代码重复执行2次就会出问题：第二次的console.log会覆盖第一次的。所以要给每一次请求设置唯一的（或不同的回调）函数</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)</span></span><br><span class="line"><span class="actionscript">script.src = <span class="string">'http://localhost/jsonp/server.php?callback='</span> + funcName</span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.body.appendChild(script)</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="comment">//2.随机生成一个函数名，可去测试下。随机数也可能会重复，所以加毫秒数就不大可能了。注意随机数格式。随机生成的函数，服务端不知道，所以要加到请求中</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> funcName = <span class="string">'jsonp_'</span> + <span class="built_in">Date</span>.now() + <span class="built_in">Math</span>.random().toString().substr(<span class="number">2</span>, <span class="number">5</span>)</span></span><br><span class="line"><span class="actionscript"><span class="comment">//1.全局函数都在window底下。那['']用一个字符串去传递函数的名字，好处：[]里可以通过随机数或时间戳等来生成随机性函数名，这样就不重复了</span></span></span><br><span class="line"><span class="javascript"><span class="built_in">window</span>[funcName] = <span class="function"><span class="keyword">function</span>  (<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">   <span class="built_in">console</span>.log(<span class="string">'1111'</span>, data)</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="JSONP封装"><a href="#JSONP封装" class="headerlink" title="JSONP封装"></a>JSONP封装</h3><p>有了个用例之后，开始封装。1.封装的参数跟$.get一样    2.url替换 3.callback替换 4.get会传入如id等参数——params，解析下。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsonp</span> (<span class="params">url, params, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> funcName = <span class="string">'jsonp_'</span> + <span class="built_in">Date</span>.now() + <span class="built_in">Math</span>.random().toString().substr(<span class="number">2</span>, <span class="number">5</span>)</span><br><span class="line">  <span class="comment">//解析url传入的参数</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> params === <span class="string">'object'</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> tempArr = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> params) &#123;</span><br><span class="line">      <span class="keyword">var</span> value = params[key]</span><br><span class="line">      tempArr.push(key + <span class="string">'='</span> + value)</span><br><span class="line">    &#125;</span><br><span class="line">    params = tempArr.join(<span class="string">'&amp;'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)</span><br><span class="line">  <span class="comment">//2的</span></span><br><span class="line">  script.src = url + <span class="string">'?'</span> + params + <span class="string">'&amp;callback='</span> + funcName</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(script)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>[funcName] = <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//3的</span></span><br><span class="line">    callback(data)</span><br><span class="line">    <span class="comment">//每次用完了就删除随机函数，然后移除scirpt标记</span></span><br><span class="line">    <span class="keyword">delete</span> <span class="built_in">window</span>[funcName]    	<span class="built_in">document</span>.body.removeChild(script)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用</span></span><br><span class="line">jsonp(<span class="string">'http://localhost/jsonp/server.php'</span>, &#123; <span class="attr">id</span>: <span class="number">123</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">jsonp(<span class="string">'http://localhost/jsonp/server.php'</span>, &#123; <span class="attr">id</span>: <span class="number">123</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>JQ也有封装JSONP，使用跟$.get类似</p>
<p>基本使用如：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">      ur<span class="variable">l:</span> <span class="string">'http://localhost/jsonp/server.php'</span>,</span><br><span class="line">      dataType: <span class="string">'jsonp'</span>,</span><br><span class="line">      succes<span class="variable">s:</span> <span class="function"><span class="keyword">function</span> <span class="params">(res)</span> &#123;</span></span><br><span class="line">        console.<span class="built_in">log</span>(<span class="keyword">res</span>)</span><br><span class="line">      &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>总结：因为 XMLHttpRequest 这个对象不支持对不同源地址之间的跨域请求，所以我们找到了script标记</p>
<p>面试回答：它实际上是借用了script标记可以发送不同源地址请求的一个特性去完成的一个跨域请求</p>
<h3 id="AJAX跨域（CORS）"><a href="#AJAX跨域（CORS）" class="headerlink" title="AJAX跨域（CORS）"></a>AJAX跨域（CORS）</h3><p>Cross Origin Resource Share，跨域资源共享</p>
<p>现在支持不同源地址之前的ajax请求，不过存在兼容问题、需要进行一些服务端的配置。</p>
<p>之前有个问题：涉及到AJAX操作的页面”不能“通过文件方式访问——就是跨域问题，现在也可以解决了。</p>
<p>1.服务端只需一行代码搞定：允许跨域请求header(‘Access-Control-Allow-Origin: *’);</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"></span><br><span class="line"><span class="php">$conn = mysqli_connect(<span class="string">'localhost'</span>, <span class="string">'root'</span>, <span class="string">'123456'</span>, <span class="string">'demo'</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="php">$query = mysqli_query($conn, <span class="string">'select * from users'</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">while</span> ($row = mysqli_fetch_assoc($query)) &#123;</span></span><br><span class="line"><span class="php">  $data[] = $row;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="comment">// 一行代码搞定</span></span></span><br><span class="line"><span class="php"><span class="comment">// 允许跨域请求：允许所有源对我这个源发起请求</span></span></span><br><span class="line"><span class="php"><span class="comment">//指定源：就把*换成网址</span></span></span><br><span class="line"><span class="php">header(<span class="string">'Access-Control-Allow-Origin: *'</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="php">header(<span class="string">'Content-Type: application/json'</span>);</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> json_encode($data);</span></span><br></pre></td></tr></table></figure>

<p>2.客户端不用做任何修改</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    $.<span class="keyword">get</span>('http://localhost/cors.php', &#123;&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(res)</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>


    </div>

    
    
    
        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

            <div class="social-item">
              <a target="_blank" class="social-link" href="/atom.xml">
                <span class="icon">
                  <i class="fa fa-rss"></i>
                </span>

                <span class="label">RSS</span>
              </a>
            </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/AJAX/" rel="tag"># AJAX</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/03/29/04-MySQL/" rel="prev" title="04-MySQL">
      <i class="fa fa-chevron-left"></i> 04-MySQL
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/03/29/06-Socket.io/" rel="next" title="06-Socket.io">
      06-Socket.io <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#知识回顾"><span class="nav-number">1.</span> <span class="nav-text">知识回顾</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AJAX简介"><span class="nav-number">2.</span> <span class="nav-text">AJAX简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AJAX快速上手"><span class="nav-number">3.</span> <span class="nav-text">AJAX快速上手</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#AJAX发送请求"><span class="nav-number">3.1.</span> <span class="nav-text">AJAX发送请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AJAX接收响应"><span class="nav-number">3.2.</span> <span class="nav-text">AJAX接收响应</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#readState"><span class="nav-number">3.2.1.</span> <span class="nav-text">readState</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#如何在ajax设置请求、响应"><span class="nav-number">4.</span> <span class="nav-text">如何在ajax设置请求、响应</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#具体用法："><span class="nav-number">5.</span> <span class="nav-text">具体用法：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#数据接口的概念"><span class="nav-number">5.1.</span> <span class="nav-text">数据接口的概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GET请求及实例"><span class="nav-number">5.2.</span> <span class="nav-text">GET请求及实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#POST请求及实例"><span class="nav-number">5.3.</span> <span class="nav-text">POST请求及实例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#同步模式和异步模式"><span class="nav-number">6.</span> <span class="nav-text">同步模式和异步模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#响应的数据格式XML、JSON"><span class="nav-number">7.</span> <span class="nav-text">响应的数据格式XML、JSON</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#客户端如何处理服务端响应的数据（处理响应数据渲染）"><span class="nav-number">8.</span> <span class="nav-text">客户端如何处理服务端响应的数据（处理响应数据渲染）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#以往操作：代码方式"><span class="nav-number">8.1.</span> <span class="nav-text">以往操作：代码方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模板方式"><span class="nav-number">8.2.</span> <span class="nav-text">模板方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#使用模板引擎动态渲染表格实例"><span class="nav-number">8.2.1.</span> <span class="nav-text">使用模板引擎动态渲染表格实例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#"><span class="nav-number">9.</span> <span class="nav-text">{{user.name}}</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XMLHttpRequest的兼容方案（面试）"><span class="nav-number">10.</span> <span class="nav-text">XMLHttpRequest的兼容方案（面试）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AJAX的封装"><span class="nav-number">11.</span> <span class="nav-text">AJAX的封装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#最终版"><span class="nav-number">11.1.</span> <span class="nav-text">最终版</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#回调"><span class="nav-number">12.</span> <span class="nav-text">回调</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#回调的嵌套情况"><span class="nav-number">12.1.</span> <span class="nav-text">回调的嵌套情况</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JQ的ajax"><span class="nav-number">13.</span> <span class="nav-text">JQ的ajax</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JQ的load方法-局部刷新"><span class="nav-number">14.</span> <span class="nav-text">JQ的load方法(局部刷新)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#全局事件处理函数"><span class="nav-number">14.1.</span> <span class="nav-text">全局事件处理函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#最常见的加载进度方式"><span class="nav-number">14.2.</span> <span class="nav-text">最常见的加载进度方式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#跨域"><span class="nav-number">15.</span> <span class="nav-text">跨域</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JSONP技巧"><span class="nav-number">15.1.</span> <span class="nav-text">JSONP技巧</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JSONP封装"><span class="nav-number">15.2.</span> <span class="nav-text">JSONP封装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AJAX跨域（CORS）"><span class="nav-number">15.3.</span> <span class="nav-text">AJAX跨域（CORS）</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="谢红斌"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">谢红斌</p>
  <div class="site-description" itemprop="description">谢红斌个人网站-记录web前端学习的个人博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hongbinxie" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hongbinxie" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">谢红斌</span>
</div>
        
<div class="busuanzi-count">
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        本站访客数<span id="busuanzi_value_site_uv"></span>人次
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        本站总访问量<span id="busuanzi_value_site_pv"></span>次
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/yinghua.js"></script>

<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  
  

  
	<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
